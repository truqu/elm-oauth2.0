<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="assets/css/style.css" />
    <link rel="stylesheet" href="assets/css/branding.css" />
</head>
<body>
  <div id="app" class="flex flex-column"></div>
  <script src="dist/app.min.js"></script>
  <script>
    const app = Elm.Main.init({
        node: document.getElementById("app"),
        flags: rememberedBytes()
    });

    /* Fetch back generated bytes from the local storage */
    function rememberedBytes() {
      const bytes = localStorage.getItem("bytes");
      return bytes ? bytes.split(",").map(x => parseInt(x,10)) : null;
    }

    /* Generate high entropy random bytes using the Web Crypto API and
    remember them so that they are preserved between redirections. This
    allows to protect for XSS & authorization code attacks */
    app.ports.genRandomBytes.subscribe(n => {
      const buffer = new Uint8Array(n);
      crypto.getRandomValues(buffer);
      const bytes = Array.from(buffer);
      localStorage.setItem("bytes", bytes);
      app.ports.randomBytes.send(bytes);
    });
  </script>
</body>
</html>
